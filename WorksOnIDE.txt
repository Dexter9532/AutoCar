#include <Wire.h>
#include "OPT3101.h"
#include <Arduino.h>
#include <stdint.h>
#include <util/delay.h>

// Skapa ett sensorobjekt
OPT3101 sensor;

void setup() {
    Serial.begin(9600);
    Serial.println("ğŸ” Startar...");

    Wire.begin();
    Serial.println("âœ… I2C initierat!");

    Serial.println("ğŸ” Initierar OPT3101...");
    sensor.init();
    Serial.println("âœ… OPT3101 initierad!");

    sensor.configureDefault();
    Serial.println("âœ… Standardkonfiguration klar!");
}


void loop() {
    Serial.println("ğŸ”„ BÃ¶rjar loop...");

    Serial.println("ğŸ” Startar mÃ¤tning...");
    sensor.startSample();
    Serial.println("âœ… startSample() anropad!");

    delay(10);  // VÃ¤nta lite fÃ¶r sÃ¤kerhet

    Serial.println("ğŸ” Kollar om sample Ã¤r klar...");
    while (!sensor.isSampleDone()) {
        Serial.print(".");  // Skriver ut punkter medan vi vÃ¤ntar
        delay(100);
    }
    Serial.println("\nâœ… Sample Ã¤r klar!");

    Serial.println("ğŸ” LÃ¤ser ut data...");
    sensor.readOutputRegs();
    Serial.println("âœ… Data lÃ¤st!");

    Serial.print("Kanal: ");
    Serial.print(sensor.channelUsed);
    Serial.print(" | ğŸ“ AvstÃ¥nd: ");
    Serial.print(sensor.distanceMillimeters);
    Serial.print(" mm | ğŸ“¡ Amplitud: ");
    Serial.println(sensor.amplitude);

    delay(1000);
}

